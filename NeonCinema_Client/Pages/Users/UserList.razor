@page "/updateuser"
@using NeonCinema_Application.DataTransferObject.User
@using NeonCinema_Client.IServices.User
@using NeonCinema_Domain.Enum
@inject IUserServices UserService
@inject NavigationManager Navigation

<div class="container mt-4" style="color: white">
    <h4 class="mb-4">Chỉnh sửa Thông Tin Người Dùng</h4>

    @if (user == null)
    {
        <p>Đang tải dữ liệu...</p>
    }
    else
    {
        <form class="form-horizontal" @onsubmit="SaveChanges">
            <div class="form-group">
                <label for="images"><img src="@user.Images" alt="Ảnh người dùng" class="img-fluid rounded-circle" /></label>
            </div>

            <div class="form-group">
                <label for="fullName">Họ và tên</label>
                <input type="text" id="fullName" @bind="user.FullName" class="form-control" />
            </div>

            <div class="form-group">
                <label for="phoneNumber">Số điện thoại:</label>
                <input type="text" id="phoneNumber" @bind="user.PhoneNumber" class="form-control" />
            </div>

            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" @bind="user.Email" class="form-control" />
            </div>

            <div class="form-group">
                <label for="gender">Giới tính:</label>
                <select id="gender" @bind="user.Gender" class="form-control">
                    <option value="Male">Nam</option>
                    <option value="Female">Nữ</option>
                    <option value="Other">Khác</option>
                </select>
            </div>

            <div class="form-group">
                <label for="dateOfBirth">Ngày sinh nhật</label>
                <input type="date" id="dateOfBirth" @bind="user.DateOrBriht" class="form-control" />
            </div>

            <div class="form-group">
                <label for="address">Địa chỉ</label>
                <input type="text" id="address" @bind="user.Adderss" class="form-control" />
            </div>

            <div class="form-group">
                <label for="status">Trạng thái:</label>
                <select id="status" @bind="user.Status" class="form-control">
                    <option value="@EntityStatus.Active">Hoạt động</option>
                    <option value="@EntityStatus.Locked">Không hoạt động</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Lưu Thay Đổi</button>
        </form>
    }
</div>

@code {
    private UserDTO user;
    private string phoneNumber;

    protected override async Task OnInitializedAsync()
    {
        var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);
        if (query.ContainsKey("phoneNumber"))
        {
            phoneNumber = query["phoneNumber"];
            if (!string.IsNullOrEmpty(phoneNumber))
            {
                user = await UserService.GetByIDUser(phoneNumber, CancellationToken.None);
            }
        }
    }

    private async Task SaveChanges()
    {
        // await UserService.UpdateUser(user);
        Navigation.NavigateTo("/listuser");
    }
}
